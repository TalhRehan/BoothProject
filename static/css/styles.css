/* =========================================
   Sticker Booth â€” UI/UX Redesign (Final)
   ========================================= */

/* ---------- Core Theme Tokens (Dark default) ---------- */
:root {
  --bg: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
  --surface: rgba(255, 255, 255, 0.05);
  --surface-elevated: rgba(255, 255, 255, 0.08);
  --glass: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.2);

  --header: rgba(30, 30, 50, 0.95);
  --text: #ffffff;
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-muted: rgba(255, 255, 255, 0.55);

  --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --primary-hover: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
  --accent: #00f5ff;
  --accent-glow: rgba(0, 245, 255, 0.3);

  --border: rgba(255, 255, 255, 0.1);
  --shadow: 0 12px 24px rgba(0, 0, 0, 0.28);
  --shadow-elevated: 0 20px 44px rgba(0, 0, 0, 0.4);
  --glow: 0 0 34px rgba(102, 126, 234, 0.28);

  --radius: 16px;
  --radius-lg: 24px;
  --blur: blur(20px);
}

/* ---------- Light Theme Map ---------- */
:root[data-theme="light"] {
  --bg: #f8fafc; /* solid bg for clarity; switch to gradient if desired */
  --surface: rgba(0, 0, 0, 0.04);
  --surface-elevated: rgba(0, 0, 0, 0.06);
  --glass: rgba(255, 255, 255, 0.85);
  --glass-border: rgba(0, 0, 0, 0.08);

  --header: rgba(255, 255, 255, 0.9);
  --text: #0f172a;
  --text-secondary: rgba(15, 23, 42, 0.7);
  --text-muted: rgba(15, 23, 42, 0.55);

  --primary: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
  --primary-hover: linear-gradient(135deg, #4338ca 0%, #6d28d9 100%);
  --accent: #2563eb;
  --accent-glow: rgba(37, 99, 235, 0.25);

  --border: rgba(0, 0, 0, 0.08);
  --shadow: 0 12px 24px rgba(2, 6, 23, 0.08);
  --shadow-elevated: 0 20px 44px rgba(2, 6, 23, 0.12);
  --glow: 0 0 34px rgba(79, 70, 229, 0.25);
}

/* ---------- Semantic Tokens (Theme-agnostic names) ---------- */
:root {
  --fg-strong: var(--text);
  --fg: var(--text-secondary);
  --fg-muted: var(--text-muted);

  --surface-1: var(--glass);
  --surface-2: var(--surface);
  --surface-3: var(--surface-elevated);

  --bd: var(--glass-border);
  --focus-ring: var(--accent);

  --brand: var(--accent);
  --brand-grad: var(--primary);
  --brand-grad-hover: var(--primary-hover);

  --success: #22c55e;
  --warning: #f59e0b;
  --error:   #ef4444;
  --info:    #0ea5e9;

  --elev-1: var(--shadow);
  --elev-2: var(--shadow-elevated);

  --r-xs: 10px;
  --r-sm: 12px;
  --r-md: 14px;
  --r-lg: var(--radius);
  --r-xl: var(--radius-lg);

  --sp-1: 6px;
  --sp-2: 10px;
  --sp-3: 14px;
  --sp-4: 16px;
  --sp-5: 20px;
  --sp-6: 24px;
  --sp-7: 32px;
  --sp-8: 40px;

  --t-fast: 160ms;
  --t-med: 220ms;
  --t-slow: 320ms;
  --bezier: cubic-bezier(0.4, 0, 0.2, 1);
}

/* ---------- Global Resets ---------- */
* { box-sizing: border-box; }

body {
  font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
  color: var(--fg-strong);
  background: var(--bg);
  font-weight: 500;
  overflow-x: hidden;
  line-height: 1.6;
}

/* Typography */
:root {
  --font-sans: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
  --fs-xs: 0.82rem;
  --fs-sm: 0.9rem;
  --fs-md: 1rem;
  --fs-lg: clamp(1.05rem, 1rem + 0.4vw, 1.2rem);
  --fs-xl: clamp(1.3rem, 1.2rem + 0.6vw, 1.6rem);
  --fs-2xl: clamp(1.7rem, 1.3rem + 1.6vw, 2.4rem);
}
h1 { font-size: var(--fs-2xl); font-weight: 800; letter-spacing: -0.02em; margin: 0 0 var(--sp-4); }
h2 { font-size: var(--fs-xl);  font-weight: 800; letter-spacing: -0.01em; margin: 0 0 var(--sp-3); }
h3 { font-size: var(--fs-lg);  font-weight: 700; margin: 0 0 var(--sp-2); }
p, .tip { font-size: var(--fs-md); }
.tip { color: var(--fg); margin: var(--sp-1) 0 var(--sp-3); }
.muted { color: var(--fg-muted); }
a { color: var(--brand); text-decoration: none; transition: color var(--t-fast) var(--bezier); }
a:hover, a:focus-visible { text-decoration: underline; outline: none; }

/* ---------- Layout & Container ---------- */
.container { width: min(1200px, 92vw); margin: 24px auto; }
.app-main { padding-block: 16px; }
.camera-page, .style-page, .processing-page, .result-page, .print-page { margin-top: var(--sp-4); }

/* ---------- Header / Navbar ---------- */
.app-header {
  display: block;
  padding-block: 18px;
  padding-inline: clamp(16px, 4vw, 40px);
  background: var(--header);
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
  position: sticky;
  top: 0;
  z-index: 100;
  border-bottom: 1px solid var(--bd);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
}
.app-nav {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 16px;
}
.nav-left { justify-self: start; }
.nav-center {
  display: flex; gap: 16px; list-style: none; padding: 0; margin: 0;
  justify-content: center; align-items: center;
}
.nav-right { justify-self: end; display: flex; align-items: center; gap: 12px; }

.brand {
  font-weight: 800;
  font-size: 1.5rem;
  letter-spacing: -0.025em;
  background: linear-gradient(135deg, var(--accent), #ffffff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 0 0 30px var(--accent-glow);
}
:root[data-theme="light"] .brand {
  background: linear-gradient(135deg, var(--accent), #111111);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: none;
}

.nav-link {
  color: var(--fg);
  text-decoration: none;
  font-weight: 600;
  padding: 8px 10px;
  border-radius: var(--r-sm);
  transition: all var(--t-fast) var(--bezier);
}
.nav-link:hover, .nav-link:focus-visible {
  color: var(--fg-strong);
  background: var(--surface-2);
  outline: none;
}
.nav-link:focus-visible { outline: 2px solid var(--focus-ring); outline-offset: 2px; }
.nav-link[aria-current="page"] {
  color: var(--fg-strong);
  background: var(--surface-2);
  border-radius: var(--r-sm);
}

.header-actions > * { margin-left: 8px; }

/* ---------- Buttons ---------- */
.primary-btn, .ghost-btn, .icon-btn, .capture-fab {
  font-family: var(--font-sans);
  font-weight: 700;
  border-radius: var(--r-md);
  padding: 12px 18px;
  line-height: 1;
  border: 1px solid transparent;
  cursor: pointer;
  transition: transform var(--t-fast) var(--bezier),
              box-shadow var(--t-fast) var(--bezier),
              background var(--t-fast) var(--bezier),
              border-color var(--t-fast) var(--bezier),
              opacity var(--t-fast) var(--bezier),
              color var(--t-fast) var(--bezier);
}

/* CTA */
.primary-btn {
  background: var(--brand-grad);
  color: var(--fg-strong);
  box-shadow: var(--elev-1), var(--glow);
  text-transform: uppercase;
  letter-spacing: .4px;
}
.primary-btn:hover { background: var(--brand-grad-hover); transform: translateY(-1px); }
.primary-btn:active { transform: translateY(0) scale(.99); }
.primary-btn:disabled { opacity: .45; cursor: not-allowed; transform: none; }

/* Secondary */
.ghost-btn {
  background: var(--surface-2);
  color: var(--fg-strong);
  border: 1px solid var(--bd);
  text-transform: none;
  letter-spacing: .2px;
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
}
.ghost-btn:hover { border-color: var(--brand); background: color-mix(in oklab, var(--surface-2) 70%, var(--brand) 6%); transform: translateY(-1px); }

/* Icon button */
.icon-btn {
  display: inline-flex; align-items: center; justify-content: center;
  height: 40px; width: 40px; border-radius: 999px;
  border: 1px solid var(--bd);
  background: var(--surface-2);
  color: var(--fg-strong);
  cursor: pointer;
  transition: transform var(--t-fast) var(--bezier), box-shadow var(--t-fast) var(--bezier), background var(--t-fast) var(--bezier), border-color var(--t-fast) var(--bezier);
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
}
.icon-btn:hover { transform: translateY(-1px); box-shadow: var(--elev-1); border-color: var(--brand); }
.icon-btn:active { transform: translateY(0) scale(0.98); }

/* FAB on camera stream */
.capture-fab {
  position: absolute; bottom: 18px; left: 50%; transform: translateX(-50%);
  padding: 14px 26px;
  text-transform: uppercase;
  background: var(--brand-grad);
  color: var(--fg-strong);
  border: 1px solid var(--bd);
  border-radius: 999px;
  box-shadow: var(--glow), var(--elev-1);
}
.capture-fab:hover { background: var(--brand-grad-hover); }
.capture-fab:disabled { opacity: .5; cursor: not-allowed; }
.primary-btn:active,
.ghost-btn:active,
.icon-btn:active { transform: translateY(0) scale(0.98); }

/* Focus states (a11y) */
.primary-btn:focus-visible,
.ghost-btn:focus-visible,
.icon-btn:focus-visible,
.style-card:focus-visible,
select:focus-visible,
a:focus-visible { outline: 2px solid var(--focus-ring); outline-offset: 2px; }

/* ---------- Camera & Overlay ---------- */
.video-wrap { position: relative; width: 100%; max-width: none; overflow: hidden; }
video {
  display: block;
  width: 100%;
  height: clamp(360px, 70vh, 860px);
  object-fit: cover;
  background: #000;
  border-radius: var(--radius);
}
.overlay {
  position: absolute; inset: 0;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  pointer-events: none; border-radius: var(--r-md);
}
.countdown {
  font-size: clamp(48px, 8vw, 96px);
  font-weight: 800;
  color: rgba(255,255,255,0.96);
  text-shadow: 0 6px 24px rgba(0,0,0,0.35);
  transform: scale(1);
  animation: pop var(--t-med) var(--bezier) 1;
}
@keyframes pop { from { transform: scale(0.92); opacity: .6; } to { transform: scale(1); opacity: 1; } }

/* ---------- Review / Style / Result Layouts ---------- */
.review-layout { display: grid; grid-template-columns: 1.4fr 1fr; gap: 40px; align-items: start; }
.review-layout .left-col .photo-frame { margin: 0; max-width: none; }
.review-layout .right-col h2 { margin: 8px 0 8px; text-align: left; }
.review-layout .right-col .tip { margin: 0 0 20px; text-align: left; color: var(--fg); font-size: 1.05rem; }
.review-layout .right-col .controls { display: flex; gap: 12px; flex-wrap: wrap; justify-content: flex-start; margin-top: 8px; }
.review-layout .right-col .controls .ghost-btn,
.review-layout .right-col .controls .primary-btn { padding: 14px 20px; font-size: 1rem; border-radius: var(--r-md); }

.style-page { display: grid; grid-template-columns: 1fr 1.2fr; gap: 48px; align-items: start; }

.compare-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-top: 32px; align-items: start; }
.panel { text-align: left; }
.panel-title {
  font-weight: 800; margin-bottom: 16px; font-size: 1.1rem; color: var(--brand);
  text-transform: uppercase; letter-spacing: 0.5px;
}

/* ---------- Frames (Photos) ---------- */
.photo-frame, .photo-frame.large {
  margin: var(--sp-6) auto;
  padding: var(--sp-4);
  border: 1px solid var(--bd);
  border-radius: var(--r-lg);
  background: var(--surface-1);
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
  box-shadow: var(--elev-2);
}
.left-pane .photo-frame { margin: 0; }
.photo-frame img, .photo-frame.large img {
  width: 100%; height: auto; display: block; object-fit: contain;
  border-radius: var(--r-sm);
  box-shadow: 0 16px 32px rgba(0,0,0,.22);
}

/* ---------- Style Cards ---------- */
.style-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--sp-4); margin-bottom: var(--sp-3); }
.style-card {
  text-align: left;
  background: var(--surface-1);
  border: 1px solid var(--bd);
  border-radius: var(--r-md);
  padding: var(--sp-4);
  min-height: 84px;
  display: flex; flex-direction: column; gap: var(--sp-2);
  box-shadow: var(--elev-1);
  transition: transform var(--t-fast) var(--bezier), box-shadow var(--t-fast) var(--bezier), border-color var(--t-fast) var(--bezier), background var(--t-fast) var(--bezier);
}
.style-card:hover { transform: translateY(-4px); box-shadow: var(--elev-2); border-color: var(--brand); }
.style-card.selected {
  border-color: var(--brand);
  background: color-mix(in oklab, var(--surface-1) 85%, var(--brand) 15%);
  transform: translateY(-2px);
}
:root[data-theme="light"] .style-card.selected { background: rgba(37, 99, 235, 0.06); }
.style-icon { font-size: 24px; filter: drop-shadow(0 0 12px var(--accent-glow)); }
.style-title { font-weight: 700; font-size: var(--fs-md); color: var(--fg-strong); }
.style-desc { color: var(--fg); font-size: var(--fs-sm); line-height: 1.5; }

/* ---------- Modal ---------- */
.modal {
  border: none;
  border-radius: var(--r-lg);
  padding: 24px;
  width: min(560px, 94vw);
  box-shadow: var(--elev-2);
  background: var(--surface-1);
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
  border: 1px solid var(--bd);
  color: var(--fg-strong);
}
.modal::backdrop { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
.modal h3 {
  margin: 0 0 24px;
  font-size: var(--fs-lg);
  font-weight: 700;
  background: linear-gradient(135deg, var(--brand), #ffffff);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.modal label { display: block; font-weight: 600; margin: 20px 0 12px; color: var(--fg); }
.modal select {
  width: 100%;
  padding: 14px 16px;
  border-radius: var(--r-sm);
  border: 1px solid var(--bd);
  background: var(--surface-2);
  color: var(--fg-strong);
  font-size: 1rem;
}
.modal select:focus { outline: 2px solid var(--focus-ring); outline-offset: 2px; }
.modal-actions { margin-top: 24px; display: flex; justify-content: flex-end; gap: 12px; }

/* ---------- Processing ---------- */
.processing-page { max-width: 800px; margin: 0 auto; text-align: center; }
.progress-wrap { margin: 32px auto 16px; }
.progress-bar {
  position: relative;
  height: 20px;
  background: var(--surface-2);
  border-radius: 50px;
  overflow: hidden;
  border: 1px solid var(--bd);
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
}
.progress-fill {
  display: block;
  height: 100%;
  background: linear-gradient(90deg, var(--accent), #667eea, var(--accent));
  background-size: 200% 100%;
  animation: shimmer var(--t-slow) var(--bezier) infinite alternate;
  transition: width var(--t-med) var(--bezier);
  border-radius: 50px;
  box-shadow: 0 0 20px var(--accent-glow);
}
@keyframes shimmer { 0% { background-position: 0% 0; } 100% { background-position: 100% 0; } }
@media (prefers-reduced-motion: reduce) { .progress-fill { animation: none; } }

.progress-meta { display: flex; justify-content: space-between; color: var(--fg); margin-top: 12px; font-weight: 600; }
.loader {
  width: 60px; height: 60px; border-radius: 50%;
  border: 4px solid var(--surface-2); border-top-color: var(--brand);
  margin: 32px auto; animation: spin 1s linear infinite; box-shadow: 0 0 30px var(--accent-glow);
}
@keyframes spin { to { transform: rotate(360deg); } }

.actions { margin-top: 50px; }
.subtle { color: var(--fg-muted); margin: 24px 0; font-size: 1rem; }

/* ---------- Result ---------- */
.result-page { max-width: 1200px; margin: 0 auto; text-align: center; }

/* ---------- Print Page ---------- */
.print-page { max-width: 980px; margin: 0 auto; text-align: center; }
#a4Preview {
  width: min(900px, 95vw);
  max-width: 100%;
  height: auto;
  display: block;
  background: #ffffff;
  border: 1px solid var(--bd);
  border-radius: 12px;
  box-shadow: var(--elev-2);
}
/* Screen: normal flow preview for the figure */
.print-sheet {
  margin: 0 auto;
  padding: 0;
  width: auto;
  height: auto;
  border: none !important;
  box-shadow: none !important;
}

/* ---------- Toasts (optional UI; keep if using toast helper) ---------- */
#toastHost {
  position: fixed;
  top: 32px;
  right: 32px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 12px;
  pointer-events: none;
}
.toast {
  min-width: 280px;
  max-width: 480px;
  padding: 20px 24px;
  border-radius: 16px;
  box-shadow: var(--elev-2);
  color: var(--fg-strong);
  opacity: 0;
  transform: translateX(100%);
  transition: all 0.4s var(--bezier);
  pointer-events: auto;
  font-weight: 600;
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
  border: 1px solid var(--bd);
}
.toast.show { opacity: 1; transform: translateX(0); }
.toast-error   { background: linear-gradient(135deg, #ff4757, #ff3838); box-shadow: 0 0 30px rgba(255, 71, 87, 0.3), var(--shadow-elevated); }
.toast-success { background: linear-gradient(135deg, #2ed573, #1dd1a1); box-shadow: 0 0 30px rgba(46, 213, 115, 0.3), var(--shadow-elevated); }
.toast-info    { background: var(--brand-grad); box-shadow: var(--glow), var(--shadow-elevated); }

/* ---------- Badges (optional utility) ---------- */
.badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; font-weight: 700; font-size: var(--fs-xs); }
.badge.success { background: color-mix(in oklab, white 70%, var(--success) 30%); color: #064e3b; border: 1px solid color-mix(in oklab, white 40%, var(--success) 60%); }
.badge.info    { background: color-mix(in oklab, white 70%, var(--info) 30%);    color: #0c4a6e; border: 1px solid color-mix(in oklab, white 40%, var(--info) 60%); }
.badge.warn    { background: color-mix(in oklab, white 70%, var(--warning) 30%); color: #78350f; border: 1px solid color-mix(in oklab, white 40%, var(--warning) 60%); }
.badge.error   { background: color-mix(in oklab, white 70%, var(--error) 30%);   color: #7f1d1d; border: 1px solid color-mix(in oklab, white 40%, var(--error) 60%); }
:root[data-theme="dark"] .badge.success { background: color-mix(in oklab, black 70%, var(--success) 30%); color: #bbf7d0; border-color: color-mix(in oklab, black 50%, var(--success) 50%); }
:root[data-theme="dark"] .badge.info    { background: color-mix(in oklab, black 70%, var(--info) 30%);    color: #bae6fd; border-color: color-mix(in oklab, black 50%, var(--info) 50%); }
:root[data-theme="dark"] .badge.warn    { background: color-mix(in oklab, black 70%, var(--warning) 30%); color: #fde68a; border-color: color-mix(in oklab, black 50%, var(--warning) 50%); }
:root[data-theme="dark"] .badge.error   { background: color-mix(in oklab, black 70%, var(--error) 30%);   color: #fecaca; border-color: color-mix(in oklab, black 50%, var(--error) 50%); }

/* ---------- Scrollbars ---------- */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--surface-2); }
::-webkit-scrollbar-thumb { background: var(--bd); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--brand); }

/* ---------- Reduced Motion Safety ---------- */
@media (prefers-reduced-motion: reduce) {
  * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
}

/* ---------- Responsive ---------- */
@media (max-width: 1024px) {
  .review-layout, .style-page, .compare-grid { grid-template-columns: 1fr; gap: var(--sp-4); }
  .nav-center { display: none; }
}
@media (max-width: 640px) {
  .review-layout .right-col .controls, .controls { gap: var(--sp-2); }
  .primary-btn, .ghost-btn { width: 100%; }
}

/* ---------- Print Rules ---------- */
@media print {
  @page { size: A4 portrait; margin: 0; }

  .app-header,
  .app-main > *:not(.print-page) { display: none !important; }

  .print-page { display: block !important; margin: 0 !important; }

  /* Print: make sheet fixed A4 */
  .print-sheet {
    position: fixed;
    inset: 0;
    width: 210mm;
    height: 297mm;
    border: none !important;
    box-shadow: none !important;
  }
  .print-sheet #a4Preview {
    width: 210mm;
    height: 297mm;
    object-fit: contain;
    background: #ffffff !important;
    border: none !important;
    box-shadow: none !important;
  }
}
