<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Sticker Booth</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}"/>
</head>
<body>
<!-- Navbar -->
<header class="app-header" role="navigation" aria-label="Primary">
    <nav class="app-nav">
        <div class="nav-left">
            <a class="brand" href="{{ url_for('camera') }}" aria-label="Sticker Booth">Sticker Booth</a>
        </div>

        <div class="nav-right">
            <!-- Theme toggle -->
            <button id="themeToggle" class="icon-btn" aria-pressed="false" aria-label="Toggle theme"
                    title="Toggle theme">
                <img id="themeIcon" alt="Theme" src="{{ url_for('static', filename='img/dark_mode.png') }}">
            </button>

            <!-- Settings (theme-aware icon) -->
            <button id="settingsBtn" class="icon-btn" aria-label="Settings" title="Settings">
                <img id="settingsIcon" alt="Settings"
                     src="{{ url_for('static', filename='img/darkThemeSettings.png') }}">
            </button>

            <div class="header-actions">
                {% block header_actions %}{% endblock %}
            </div>
        </div>
    </nav>
</header>

<main class="app-main container">
    {% block content %}{% endblock %}
</main>

<div id="toastHost" aria-live="polite" aria-atomic="true"></div>

<!-- Theme bootstrap -->
<script>
    (function(){
      const root = document.documentElement;
      const STORAGE_KEY = 'theme';
      const btn = document.getElementById('themeToggle');
      const iconImg = document.getElementById('themeIcon');
      const settingsImg = document.getElementById('settingsIcon');

      const LIGHT_ICON = "{{ url_for('static', filename='img/light_mode.png') }}";
      const DARK_ICON  = "{{ url_for('static', filename='img/dark_mode.png') }}";
      const LIGHT_SETTINGS = "{{ url_for('static', filename='img/lightThemeSettings.png') }}";
      const DARK_SETTINGS  = "{{ url_for('static', filename='img/darkThemeSettings.png') }}";

      function setIcons(theme) {
        iconImg.src = theme === 'light' ? LIGHT_ICON : DARK_ICON;
        settingsImg.src = theme === 'light' ? LIGHT_SETTINGS : DARK_SETTINGS;
      }

      function apply(theme) {
        root.setAttribute('data-theme', theme);
        setIcons(theme);
        btn?.setAttribute('aria-pressed', String(theme === 'dark'));
        try { localStorage.setItem(STORAGE_KEY, theme); } catch {}
      }

      let theme = 'dark';
      try {
        theme = localStorage.getItem(STORAGE_KEY) ||
                (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
      } catch {}
      apply(theme);

      btn?.addEventListener('click', () => {
        apply(root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
      });
    })();
</script>

{% block scripts %}{% endblock %}
</body>
</html>
