{% extends 'base.html' %}
{% block title %}Camera - Sticker Booth{% endblock %}
{% block content %}
<div class="camera-page">
  <div class="camera-interface">
    <!-- Video Container -->
    <div class="video-container">
      <video id="video"
             autoplay
             playsinline
             muted
             aria-label="Camera preview">
      </video>

      <!-- Countdown Overlay -->
      <div id="overlay" class="overlay" style="display: none;" role="status" aria-live="polite">
        <div id="countdown" class="countdown" aria-label="Countdown">5</div>
      </div>

      <!-- Capture Button -->
      <button id="captureBtn"
              class="capture-fab"
              type="button"
              aria-label="Capture photo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
          <circle cx="12" cy="13" r="4"/>
        </svg>

      </button>
    </div>
  </div>

  <!-- Quick Tips Card -->
  <div class="card tips-card mt-8">
    <h3>ðŸ’¡ Quick Tips</h3>
    <div class="tips-grid">
      <div class="tip-item">
        <div class="tip-icon">ðŸ“¸</div>
        <div class="tip-content">
          <strong>Good Lighting</strong>
          <p>Face a window or bright light source for best results</p>
        </div>
      </div>
      <div class="tip-item">
        <div class="tip-icon">ðŸ‘¤</div>
        <div class="tip-content">
          <strong>Center Yourself</strong>
          <p>Keep your face centered in the frame</p>
        </div>
      </div>
      <div class="tip-item">
        <div class="tip-icon">ðŸ˜Š</div>
        <div class="tip-content">
          <strong>Smile!</strong>
          <p>Express yourself - the AI works better with clear expressions</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Hidden Elements -->
<canvas id="captureCanvas"
        width="1280"
        height="960"
        hidden
        aria-hidden="true">
</canvas>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/camera.js') }}?v={{ cache_bust_version | default('2024') }}" defer></script>

<!-- Camera Page Script (no settings modal wiring here) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  'use strict';

  // Capture button vibration feedback
  const captureBtn = document.getElementById('captureBtn');
  if (captureBtn && 'vibrate' in navigator) {
    captureBtn.addEventListener('click', () => navigator.vibrate(50));
  }

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if ((e.key === ' ' || e.key === 'Enter') && e.target === document.body) {
      e.preventDefault();
      if (captureBtn && !captureBtn.disabled) captureBtn.click();
    }
  });

  // Page visibility handling
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
      if (window.resumeCamera) window.resumeCamera();
    } else {
      if (window.pauseCamera) window.pauseCamera();
    }
  });
});
</script>
{% endblock %}
